<html>
  <head>
    <!-- Vendor includes -->
    <script type="text/javascript" src="/vendor/jquery-1.7.js"></script>
    <script type="text/javascript" src="/vendor/underscore.js"></script>
    <script type="text/javascript" src="/vendor/backbone.js"></script>
    <script type="text/javascript" src="/vendor/htmlparser.js"></script>
  
    <!-- Initialize -->
    <script type="text/javascript" src="/util/backend-util.js"></script>
    <script type="text/javascript" src="/util/parser-suite.js"></script>
    <script type="text/javascript" src="/frontend/scripts/track-parser.js"></script>
    <script type="text/javascript" src="backend-init.js"></script>
    <script type="text/javascript" src="bank.js"></script>
    <script type="text/javascript" src="cassettemanager.js"></script>
    <script type="text/javascript" src="templatemanager.js"></script>
    <script type="text/javascript" src="injectmanager.js"></script>
    <script type="text/javascript" src="messagehandler.js"></script>
    <script type="text/javascript" src="sequencer.js"></script>
  
    <!-- Models -->
    <script type="text/javascript" src="models/cassette.js"></script>
    <script type="text/javascript" src="models/cassettelist.js"></script>
    <script type="text/javascript" src="models/track.js"></script>
    <script type="text/javascript" src="models/tracklist.js"></script>
    <script type="text/javascript" src="models/playlist.js"></script>
    <script type="text/javascript" src="models/playlistlist.js"></script>

    <!-- Cassettes -->
    <script type="text/javascript" src="models/cassettes/scraper-cassette.js"></script>
    <script type="text/javascript" src="models/cassettes/cassettify-template.js"></script>

    <!-- Default Views -->
    <script type="text/javascript" src="views/browseregion-view.js"></script>
    <script type="text/javascript" src="views/cassettelist-view.js"></script>
    <script type="text/javascript" src="views/tracklist-view.js"></script>
    <script type="text/javascript" src="views/queue-view.js"></script>
    <script type="text/javascript" src="views/browselist-view.js"></script>
    <script type="text/javascript" src="views/playlistlist-view.js"></script>
    <script type="text/javascript" src="views/frame-view.js"></script>
    <script type="text/javascript" src="views/player-view.js"></script>
    <script type="text/javascript" src="views/modal-view.js"></script>

    <script id="Frame-default-template" type="text/template">
      <div id="player">Player Here</div>
      <div id="queue-region" class="region">
        <div class="region-header">Queue</div>
        <div id="queue-list" class="tracklist"></div>
  
        <div id="queue-buttons">
          <div id="playlist-list"></div>
          
          <button id="queue-save"
                  type="button"
                  onclick="Tapedeck.Frontend.Frame.PlaylistList.saveQueue()">
            Save
          </button>
          <div id="playback-button-box">
            <img id="repeat"
                 class="playback-button"
                 onclick="Tapedeck.Frontend.Frame.toggleRepeat()"></img>
            <img id="queue-shuffle"
                 class="playback-button"
                 onclick="Tapedeck.Frontend.Frame.shuffleQueue()"></img>
            <img id="queue-clear"
                 class="playback-button"
                 onclick="Tapedeck.Frontend.Frame.clearQueue()"></img>
          </div>
        </div>
      </div>

      <div id="browse-region" class="region"></div>
    </script>

    <script id="BrowseRegion-default-template" type="text/template">
      <div class="region-header">Browse or Cassettes</div>
      <div id="browse-list" class="tracklist"></div>
      <div id="cassette-list" class="cassettelist"></div>
    </script>

    <script id="Player-default-template" type="text/template">
      <div id="banner-region">
        <div id="banner">
          <%
          var bannerStr = "";
  
          if (state != "stop" && typeof(track) != "undefined") {
            if (typeof(track.artistName) != "undefined") {
              bannerStr += track.artistName;
            }
            if (typeof(track.trackName) != "undefined") {
              if (bannerStr.length > 0) {
                bannerStr += " &ndash; ";
              }
              bannerStr += track.trackName;
            }
          }
  
          if (state == "load") {
            bannerStr += "<br />(Loading)";
          }
          else if (state == "pause") {
            bannerStr += "<br />(Paused)";
          }
          print(bannerStr);
          %>
        </div>
        <div id="volume-slider"
             class="slider
                    <% if (state != "play" && state != "pause") {
                      print(" disabled ");
                    }%>" >
          <div id="track-top" class="slider-track"></div>
          <div id="track-bottom" class="slider-track">
            <div id="handle">
              <img id="handle-image"></img>
            </div>
          </div>
        </div>
      </div>

      <div id="seek-slider"
           class="slider
                  <% if (state != "play" && state != "pause") {
                    print(" disabled ");
                  }%>" >
        <div id="track-left" class="slider-track"></div>
        <div id="track-right" class="slider-track">
          <div id="handle">
            <div id="handle-val"></div>
            <img id="handle-image"></img>
          </div>
        </div>
      </div>
      <div id="duration"></div>
    </script>

    <script id="TrackList-default-template" type="text/template">
      <div class="tracklist">
        <% if (trackList.length == 0) { %>
          <div class="row-container">
            <div class="row blank">
              <% if (trackList.destination == "Queue") { %>
                There are no tracks in your queue.
              <% }
              else { %>
                Sorry, this cassette seems blank.
              <% } %>
            </div>
          </div>

        <% }
        else { %>
          <div class="row-container">
            <div class="row" id="hidden-droprow" index="-1">
              <div class="cell trackName-col"></div>
              <div class="cell artistName-col"></div>
              <div class="cell cassette-col"></div>
            </div>
          </div>
  
          <% for (var i=0; i < trackList.length; i++) {
            var track = trackList[i];
          %>
            <div class="row-container">
              <div class="row
                          <% if (track.listened) { print(" listened ") } %>
                          <% if (track.playing) { print(" playing ") } %>"
                   index='<%= i %>'
                   track-id='<%= track.tdID %>'
                   track-type='<% if(typeof(track.type) == "undefined") {
                                    print("unknown")
                                  } else {
                                    print(track.type)
                                  } %>'
                   <% if (typeof(track.download) != "undefined") {
                      print("download='" + track.download + "'");
                   } %> 
                   draggable="true"
                   onclick="Tapedeck.Frontend.Frame.TrackLists.
                                    rowClick(event)" >
                <div class="cell trackName-col" title='<%= track.trackName %>'>
                  <span class="trackName-span"
                        onclick="Tapedeck.Frontend.Frame.TrackLists.
                                         rowDblClick(event)">
                    <%= track.trackName %>
                  </span>
                </div>
                <div class="cell artistName-col" title='<%= track.artistName %>'>
                  <%= track.artistName %>
                </div>
                <div class="cell cassette-col" title='<%= track.cassette %>'>
                  <%= track.cassette %>
                  <div class="row-buttons">
                    <div class="button playnow"
                         onclick="Tapedeck.Frontend.Frame.TrackLists.
                                          rowButtonPlaynow(event)"></div>
                    <div class="button remove"
                         onclick="Tapedeck.Frontend.Frame.TrackLists.
                                          rowButtonRemove(event)"></div>
                    <div class="button queue"
                         onclick="Tapedeck.Frontend.Frame.TrackLists.
                                          rowButtonQueue(event)"></div>
                    <div class="button download"
                         onclick="Tapedeck.Frontend.Frame.TrackLists.
                                          rowButtonDownload(event)"></div>
                  </div>
                  <div class="row-indicators">
                    <div class="spinner download"
                         id="download-spinner"></div>
                  </div>
                </div>
              </div>
            </div>
          <% } %>
        <% } %>
      </div>
      <% if (typeof(currentCassette) != "undefined") { %>
        <div id="current-cassette-row" class="row">
          <div class="cell current-cassette-col">
            <%= currentCassette.name %>
            <div class="row-buttons">
              <div class="button next-page"
                   onclick="Tapedeck.Frontend.Frame.TrackLists.prevPage(event)">P</div>
              <div class="button next-page"
                   onclick="Tapedeck.Frontend.Frame.TrackLists.nextPage(event)">N</div>
              <div class="button eject"
                   onclick="Tapedeck.Frontend.Frame.TrackLists.eject(event)"></div>
            </div>
          </div>
        </div>
      <% } %>
    </script>

    <script id="PlaylistList-default-template" type="text/template">
      <div id="playlist-list-header">Load a playlist</div>
      <div id="playlist-list-content">
        <% for (var i=0; i < playlistList.length; i++) {
          var playlist = playlistList.at(i);
        %>
          <div class="row"
             index='<%= i %>'
             onclick="Tapedeck.Frontend.Frame.PlaylistList.playPlaylist(event)" >
            <div class="cell playlistName-col"> <%= playlist.id %> </div>
            <div class="cell row-buttons">
              <div class="button removePlaylist"
                   onclick="Tapedeck.Frontend.Frame.PlaylistList.removePlaylist(event)"></div>
            </div>
          </div>
        <% } %>
      </div>
    </script>

    <script id="CassetteList-default-template" type="text/template">
      <div class="cassettelist">
        <% for (var i=0; i < cassetteList.length; i++) {
          var cassette = cassetteList[i];
        %>
          <div class="row-container">
            <div class="row"
                 index='<%= i %>'
                 cassette-id='<%= cassette.tdID %>' >
              <div class="cell cassetteName-col" title='<%= cassette.name %>'> <%= cassette.name %> </div>
              <div class="cell developerName-col" title='<%= cassette.developerLink %>'>
                <span id="developer-link"
                      url='<%= cassette.developerLink %>'
                      onclick="Tapedeck.Frontend.Frame.CassetteList.loadDeveloperLink(event)" >
                  <%= cassette.developer %>
                </span>
                <div class="row-buttons">
                  <!--
                  <div class="button remove"
                       onclick="Tapedeck.Frontend.Frame.rowButtonRemove(event)"></div>
                  -->
                </div>
              </div>
            </div>
          </div>
        <% } %>
        <div class="row-container button-row">
          <div class="row-buttons">
            <div id="add-cassette-button"
                 class="button"
                 onclick="Tapedeck.Frontend.Frame.CassetteList.
                                  showAddCassettes(event)"></div>
          </div>
        </div>
        <div id="add-cassettes-menu">
          <div class="menu-row coming-soon">
            Get more cassettes (coming soon)
          </div>
          <div class="menu-row"
               onclick="Tapedeck.Frontend.Frame.CassetteList.
                                cassettify(event)">
            'Cassettify' current page
          </div>
          <div class="menu-row"
               onclick="Tapedeck.Frontend.Messenger.clear()">
           !~ Clear database
          </div>
        </div>
      </div>
    </script>

    <script id="Modal-default-template" type="text/template">
      <!-- Note options are params.X here -->
      <div id="blackout"></div>
      <div id="modal">
        <div id="close-button" onclick="Tapedeck.Frontend.Frame.Modal.close(true)"></div>
        <span id="modal-title"><% if (typeof(params.title) != "undefined") print(params.title);  %></span> 
        <form id="modal-form">
          <% for (var i=0; i < params.fields.length; i++) {
            var field = params.fields[i]; %>
            <div class="field-row row">
              <% if (field.type == "info") { %>
                <span class="info"><%= field.text %></span>
              <% } else if (field.type == "input") { %>
                <span class="input"><%= field.text %></span>
                <input callbackParam="<%= field.callbackParam %>"
                       type="text"
                       onkeypress="if (event.which == 13) { Tapedeck.Frontend.Frame.Modal.submit(); return false; }">
              <% } %>
            </div>
          <% } %>
          <% if (typeof(params.submitButtons) == "undefined") { %>
            <input type="button"
                   onclick="Tapedeck.Frontend.Frame.Modal.submit();"
                   value="Ok" />
          <% } else {
            for (var i=0; i < params.submitButtons.length; i++) {
              var button = params.submitButtons[i]; %>
              <input type="button"
                     onclick="Tapedeck.Frontend.Frame.Modal.submit('<%= button.callbackParam %>');" +
                     value="<%= button.text %>" />
            <% }
          } %>
        </form>
      </div>
    </script>
  
    <script type="text/javascript">
      $(function() {
          Tapedeck.Backend.init();
      });
    </script>
    
  </head>
  <body>
    <audio id="audioplayer" preload="auto">
    </audio>
    <div id="dump"> </div>
  </body>
  
</html>
